{% extends 'base.html' %}
{% load static %}

{% block title %}Каталог - Гарант Групп{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero">
    <div class="hero-bg">
        <div class="floating-shape shape-1"></div>
        <div class="floating-shape shape-2"></div>
        <div class="floating-shape shape-3"></div>
    </div>
    <div class="container">
        <div class="hero-content">
            <h1 class="hero-title">Каталог модульных бань</h1>
            <p class="hero-subtitle" style="font-size: 1.2rem; max-width: 800px; margin: 0 auto;">Выберите готовый проект или закажите индивидуальную баню. Все модели производятся на нашем заводе в Вологде из качественной северной древесины. Срок изготовления — 1-2 недели, сборка на участке — 1-2 дня.</p>
        </div>
    </div>
</section>

<!-- Products Section -->
<section class="section">
    <div class="container">
      <h2 class="section-title" style="text-align: center; margin-bottom: 3rem;">Наши модели бань</h2>
      {% if products %}
        <div class="products-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 2rem;">
          {% for product in products %}
            <div class="product-item card" style="border-top: 4px solid var(--accent-terracotta); padding: 1.5rem; border-radius: 0 0 var(--radius-lg) var(--radius-lg); background: var(--white); box-shadow: var(--shadow-sm); transition: transform 0.3s ease; overflow: hidden;">
              <div class="product-image" style="position: relative; height: 250px; margin-bottom: 1rem; overflow: hidden; border-radius: var(--radius-md);">
                {% if product.image %}
                  <img src="{{ product.image.url }}" alt="{{ product.title }}" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s ease;">
                {% elif product.images.first %}
                  <img src="{{ product.images.first.image.url }}" alt="{{ product.title }}" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s ease;">
                {% else %}
                  <div class="placeholder" style="width: 100%; height: 100%; background: var(--gray-200); display: flex; align-items: center; justify-content: center; color: var(--gray-600);">Нет изображения</div>
                {% endif %}
              </div>
              <h3 style="margin: 1rem 0 0.5rem; font-size: 1.3rem; color: var(--gray-800);">{{ product.title }}</h3>
              <div class="product-price" style="font-size: 1.6rem; font-weight: 700; color: var(--accent-terracotta); margin-bottom: 0.5rem;">
                {% with prices=product.prices.all base_price=product.price %}
                  {% if prices or base_price > 0 %}
                    от {% if prices.first %}
                      {% with price=prices.first.price|floatformat:0 %}
                        {{ price|slice:":-3" }}{% if price|length > 3 %}{{ price|slice:"3:"|add:" " }}{% endif %} ₽
                      {% endwith %}
                    {% else %}
                      {{ base_price|floatformat:0|slice:":-3" }}{% if base_price|length > 3 %}{{ base_price|slice:"3:"|add:" " }}{% endif %} ₽
                    {% endif %}
                  {% else %}
                    Цена по запросу
                  {% endif %}
                {% endwith %}
              </div>
              <p style="color: var(--gray-700); margin-bottom: 1.5rem; line-height: 1.5;">{{ product.description|truncatechars:150 }}</p>
              <div class="product-actions" style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <a href="{% url 'product_detail' product.id %}" class="detail-btn btn btn-terra" style="padding: 0.75rem 1.5rem; text-decoration: none; font-weight: 600;">Подробнее</a>
                <a href="{% url 'order' %}?details={{ product.title }}" class="btn btn-secondary" style="padding: 0.75rem 1.5rem; text-decoration: none;">Заказать</a>
              </div>
              <style>
                .product-item:hover {
                  transform: translateY(-8px);
                  box-shadow: var(--shadow-warm);
                }
                .product-item:hover img {
                  transform: scale(1.05);
                }
              </style>
            </div>
          {% endfor %}
        </div>
        {% if products|length > 8 %}
          <div class="load-more" style="text-align: center; margin-top: 3rem;">
            <a href="#" class="btn btn-primary btn-terra" style="padding: 1rem 2rem;" onclick="loadMoreProducts(); return false;">
              <span>Загрузить ещё</span>
            </a>
          </div>
        {% endif %}
      {% else %}
        <div class="empty-message" style="text-align: center; padding: 4rem; color: var(--gray-600);">
          <h3>Каталог пуст</h3>
          <p>Добавьте товары в админ-панели.</p>
        </div>
      {% endif %}
    </div>
  </section>

  <!-- ПОЧЕМУ МЫ: Такой же как в главной (4 преимущества с иконками) -->
  <section class="section" data-animate="fade-up">
    <div class="container">
      <h2 class="section-title" style="text-align: center; margin-bottom: 3rem;">Почему выбирают Гарант Групп</h2>
      <div class="advantages-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
        <div class="advantage-item card" style="padding: 2rem; border-radius: var(--radius-lg); background: var(--white); box-shadow: var(--shadow-sm); text-align: center; transition: transform 0.3s ease;">
          <div class="advantage-icon" style="width: 60px; height: 60px; background: var(--accent-terracotta); border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; color: var(--white); font-size: 1.5rem;">✓</div>
          <h3 style="margin-bottom: 1rem; color: var(--gray-800);">Гарантия качества</h3>
          <p style="color: var(--gray-700);">Работаем по договору и даём официальную гарантию на постройки и материалы.</p>
        </div>
        <div class="advantage-item card" style="padding: 2rem; border-radius: var(--radius-lg); background: var(--white); box-shadow: var(--shadow-sm); text-align: center; transition: transform 0.3s ease;">
          <div class="advantage-icon" style="width: 70px; height: 70px; background: var(--accent-warm); border-radius: 14px; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-md);">
            <svg width="35" height="35" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="9"/><rect x="14" y="3" width="7" height="5"/><rect x="14" y="12" width="7" height="9"/><rect x="3" y="16" width="7" height="5"/></svg>
          </div>
          <h3 style="margin-bottom: 1rem; color: var(--gray-800);">Собственное производство</h3>
          <p style="color: var(--gray-700);">Контролируем весь цикл — от заготовки леса до сборки на участке.</p>
        </div>
        <div class="advantage-item card" style="padding: 2rem; border-radius: var(--radius-lg); background: var(--white); box-shadow: var(--shadow-sm); text-align: center; transition: transform 0.3s ease;">
          <div class="advantage-icon" style="width: 70px; height: 70px; background: var(--accent-warm); border-radius: 14px; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-md);">
            <svg width="35" height="35" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M8 5l4-3 4 3M8 19l4 3 4-3"/></svg>
          </div>
          <h3 style="margin-bottom: 1rem; color: var(--gray-800);">Экологичные материалы</h3>
          <p style="color: var(--gray-700);">Используем здоровую древесину из северных лесов — бани «дышат».</p>
        </div>
        <div class="advantage-item card" style="padding: 2rem; border-radius: var(--radius-lg); background: var(--white); box-shadow: var(--shadow-sm); text-align: center; transition: transform 0.3s ease;">
          <div class="advantage-icon" style="width: 70px; height: 70px; background: var(--accent-warm); border-radius: 14px; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-md);">
            <svg width="35" height="35" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
          </div>
          <h3 style="margin-bottom: 1rem; color: var(--gray-800);">Монтаж 1–2 дня</h3>
          <p style="color: var(--gray-700);">Собираем аккуратно и быстро, без строительного мусора.</p>
        </div>
      </div>
      <style>
        .advantage-item:hover {
          transform: translateY(-5px);
          box-shadow: var(--shadow-warm);
        }
      </style>
    </div>
  </section>

  <!-- НОВАЯ СЕКЦИЯ: Что входит в стоимость -->
  <section class="section" style="background: var(--wood-cream); padding: 4rem 0;" data-animate="fade-up">
    <div class="container">
      <h2 class="section-title" style="text-align: center; margin-bottom: 1.5rem; color: var(--gray-900);">Что входит в базовую комплектацию</h2>
      <p style="text-align: center; color: var(--gray-600); max-width: 700px; margin: 0 auto 3rem; font-size: 1.1rem;">Каждая баня поставляется готовой к эксплуатации. Вам нужно только подготовить фундамент — остальное мы сделаем сами.</p>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem;">
        <div style="background: var(--white); padding: 2rem; border-radius: var(--radius-lg); border: 1px solid var(--wood-light);">
          <div style="width: 80px; height: 80px; background: var(--gradient-accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
            <svg width="44" height="44" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
              <polyline points="9 22 9 12 15 12 15 22"/>
            </svg>
          </div>
          <h4 style="color: var(--gray-900); margin-bottom: 1rem; font-size: 1.2rem;">Конструкция</h4>
          <ul style="color: var(--gray-700); line-height: 1.8; list-style: none; padding-left: 0;">
            <li style="margin-bottom: 0.5rem;">✓ Профилированный брус 100x150 мм</li>
            <li style="margin-bottom: 0.5rem;">✓ Каркас из бруса 50x150 мм</li>
            <li style="margin-bottom: 0.5rem;">✓ Половая доска 36 мм</li>
            <li style="margin-bottom: 0.5rem;">✓ Стропильная система</li>
            <li style="margin-bottom: 0.5rem;">✓ Гидроизоляция и пароизоляция</li>
          </ul>
        </div>

        <div style="background: var(--white); padding: 2rem; border-radius: var(--radius-lg); border: 1px solid var(--wood-light);">
          <div style="width: 70px; height: 70px; margin: 0 auto 1rem; background: var(--accent-warm); border-radius: 14px; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-md);">
            <svg width="35" height="35" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>
          </div>
          <h4 style="color: var(--gray-900); margin-bottom: 1rem; font-size: 1.2rem;">Отделка и утепление</h4>
          <ul style="color: var(--gray-700); line-height: 1.8; list-style: none; padding-left: 0;">
            <li style="margin-bottom: 0.5rem;">✓ Вагонка липа/осина в парной</li>
            <li style="margin-bottom: 0.5rem;">✓ Вагонка сосна в комнате отдыха</li>
            <li style="margin-bottom: 0.5rem;">✓ Базальтовая вата 100 мм</li>
            <li style="margin-bottom: 0.5rem;">✓ Фольгированная пароизоляция</li>
            <li style="margin-bottom: 0.5rem;">✓ Огнезащитная обработка</li>
          </ul>
        </div>

        <div style="background: var(--white); padding: 2rem; border-radius: var(--radius-lg); border: 1px solid var(--wood-light);">
          <div style="width: 80px; height: 80px; background: var(--gradient-accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
            <svg width="44" height="44" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <circle cx="8.5" cy="12" r="0.5" fill="white"/>
              <path d="M3 8h18"/>
              <path d="M10 3v5"/>
            </svg>
          </div>
          <h4 style="color: var(--gray-900); margin-bottom: 1rem; font-size: 1.2rem;">Двери и окна</h4>
          <ul style="color: var(--gray-700); line-height: 1.8; list-style: none; padding-left: 0;">
            <li style="margin-bottom: 0.5rem;">✓ Входная дверь утепленная</li>
            <li style="margin-bottom: 0.5rem;">✓ Дверь в парную с термостеклом</li>
            <li style="margin-bottom: 0.5rem;">✓ Межкомнатные двери</li>
            <li style="margin-bottom: 0.5rem;">✓ Деревянные окна с двойным остеклением</li>
            <li style="margin-bottom: 0.5rem;">✓ Фурнитура из нержавейки</li>
          </ul>
        </div>

        <div style="background: var(--white); padding: 2rem; border-radius: var(--radius-lg); border: 1px solid var(--wood-light);">
          <div style="width: 70px; height: 70px; margin: 0 auto 1rem; background: var(--accent-warm); border-radius: 14px; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-md);">
            <svg width="35" height="35" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
          </div>
          <h4 style="color: var(--gray-900); margin-bottom: 1rem; font-size: 1.2rem;">Электрика</h4>
          <ul style="color: var(--gray-700); line-height: 1.8; list-style: none; padding-left: 0;">
            <li style="margin-bottom: 0.5rem;">✓ Внутренняя проводка в гофре</li>
            <li style="margin-bottom: 0.5rem;">✓ Распределительный щиток</li>
            <li style="margin-bottom: 0.5rem;">✓ Светильники влагозащищенные</li>
            <li style="margin-bottom: 0.5rem;">✓ Розетки и выключатели</li>
            <li style="margin-bottom: 0.5rem;">✓ Вентиляционные решетки</li>
          </ul>
        </div>
      </div>

      <div style="background: var(--accent-orange); color: var(--white); padding: 2rem; border-radius: var(--radius-xl); margin-top: 3rem; text-align: center;">
        <h3 style="margin-bottom: 1rem; font-size: 1.5rem;">Дополнительные опции (заказываются отдельно)</h3>
        <p style="font-size: 1.1rem; line-height: 1.7; opacity: 0.95;">Печь для бани (дровяная/электрическая), полки и скамейки, купель, душевая кабина, мебель для комнаты отдыха, фундамент (винтовые сваи/ленточный), терраса, наружная отделка (имитация бруса/сайдинг), система водоснабжения и канализации.</p>
        <a href="{% url 'order' %}" style="display: inline-block; margin-top: 1.5rem; background: var(--white); color: var(--accent-orange); padding: 1rem 2rem; border-radius: var(--radius-md); font-weight: 700; transition: transform 0.3s;">Рассчитать стоимость с опциями</a>
      </div>
    </div>
  </section>

  <!-- ЧАСТО ЗАДАВАЕМЫЕ ВОПРОСЫ: Аккордеон (без изменений) -->
  <section class="section bg-wood-cream" data-animate="fade-up" style="background: var(--wood-lightest);">
    <div class="container">
      <h2 class="section-title" style="text-align: center; margin-bottom: 3rem;">Часто задаваемые вопросы</h2>
      <div class="faq-grid" style="max-width: 800px; margin: 0 auto;">
        <div class="faq-item" style="margin-bottom: 1rem; background: var(--white); border: 1px solid var(--gray-200); border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow-sm);">
          <button class="faq-question" style="width: 100%; padding: 1.5rem; background: var(--accent-terracotta); color: var(--white); border: none; text-align: left; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: background 0.3s ease;">
            Сколько стоит баня под ключ?
            <span class="faq-toggle" style="float: right; transition: transform 0.3s ease;">+</span>
          </button>
          <div class="faq-answer" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease, padding 0.3s ease; color: var(--gray-700);">
            <p style="margin: 0; padding: 1.5rem; line-height: 1.6;">Цены от 150 000 руб. за базовую модель. Полная стоимость зависит от размера, опций (печь, фундамент) и доставки. Рассчитаем индивидуально по вашему участку.</p>
          </div>
        </div>
        <div class="faq-item" style="margin-bottom: 1rem; background: var(--white); border: 1px solid var(--gray-200); border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow-sm);">
          <button class="faq-question" style="width: 100%; padding: 1.5rem; background: var(--accent-terracotta); color: var(--white); border: none; text-align: left; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: background 0.3s ease;">
            Какой срок изготовления?
            <span class="faq-toggle" style="float: right; transition: transform 0.3s ease;">+</span>
          </button>
          <div class="faq-answer" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease, padding 0.3s ease; color: var(--gray-700);">
            <p style="margin: 0; padding: 1.5rem; line-height: 1.6;">Производство на складе — 3–7 дней. Монтаж на участке — 1–2 дня. Общий срок от заказа до готовности — 1 неделя.</p>
          </div>
        </div>
        <div class="faq-item" style="margin-bottom: 1rem; background: var(--white); border: 1px solid var(--gray-200); border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow-sm);">
          <button class="faq-question" style="width: 100%; padding: 1.5rem; background: var(--accent-terracotta); color: var(--white); border: none; text-align: left; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: background 0.3s ease;">
            Доставка?
            <span class="faq-toggle" style="float: right; transition: transform 0.3s ease;">+</span>
          </button>
          <div class="faq-answer" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease, padding 0.3s ease; color: var(--gray-700);">
            <p style="margin: 0; padding: 1.5rem; line-height: 1.6;">Бесплатно в пределах 50 км от Вологды. Далее — по тарифам (от 30 руб/км в зависимости от размера и расстояния). Привозим в удобное время по всей Вологодской области и соседним регионам.</p>
          </div>
        </div>
        <div class="faq-item" style="margin-bottom: 1rem; background: var(--white); border: 1px solid var(--gray-200); border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow-sm);">
          <button class="faq-question" style="width: 100%; padding: 1.5rem; background: var(--accent-terracotta); color: var(--white); border: none; text-align: left; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: background 0.3s ease;">
            Можно ли изменить проект?
            <span class="faq-toggle" style="float: right; transition: transform 0.3s ease;">+</span>
          </button>
          <div class="faq-answer" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease, padding 0.3s ease; color: var(--gray-700);">
            <p style="margin: 0; padding: 1.5rem; line-height: 1.6;">Конечно! Добавим комнату отдыха, террасу или кастомные опции. Консультация бесплатно.</p>
          </div>
        </div>
      </div>
      <style>
        .faq-question:hover {
          background: #b86340;
        }
        .faq-question.active .faq-toggle {
          transform: rotate(45deg);
        }
      </style>
    </div>
  </section>

  <!-- КАК ЗАКАЗАТЬ: Такой же как 4 шага в главной -->
  <section class="section" data-animate="fade-up">
    <div class="container">
      <h2 class="section-title" style="text-align: center; margin-bottom: 3rem;">Как заказать баню</h2>
      <div class="steps-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
        <div class="step-card card" style="padding: 2rem; border-radius: var(--radius-lg); background: var(--white); box-shadow: var(--shadow-sm); transition: transform 0.3s ease; text-align: center;">
          <div class="step-icon" style="width: 50px; height: 50px; background: var(--accent-terracotta); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--white); margin: 0 auto 1rem; font-weight: bold; font-size: 1.5rem;">1</div>
          <h3 style="margin-bottom: 1rem; color: var(--gray-800);">Выберите модель</h3>
          <p style="color: var(--gray-700);">Просмотрите каталог, выберите проект или опишите свои пожелания. Мы поможем с выбором.</p>
        </div>
        <div class="step-card card" style="padding: 2rem; border-radius: var(--radius-lg); background: var(--white); box-shadow: var(--shadow-sm); transition: transform 0.3s ease; text-align: center;">
          <div class="step-icon" style="width: 50px; height: 50px; background: var(--accent-terracotta); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--white); margin: 0 auto 1rem; font-weight: bold; font-size: 1.5rem;">2</div>
          <h3 style="margin-bottom: 1rem; color: var(--gray-800);">Консультация и расчёт</h3>
          <p style="color: var(--gray-700);">Звоните или оставьте заявку — рассчитаем стоимость, сроки и доставку под ваш участок.</p>
        </div>
        <div class="step-card card" style="padding: 2rem; border-radius: var(--radius-lg); background: var(--white); box-shadow: var(--shadow-sm); transition: transform 0.3s ease; text-align: center;">
          <div class="step-icon" style="width: 50px; height: 50px; background: var(--accent-terracotta); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--white); margin: 0 auto 1rem; font-weight: bold; font-size: 1.5rem;">3</div>
          <h3 style="margin-bottom: 1rem; color: var(--gray-800);">Договор и оплата</h3>
          <p style="color: var(--gray-700);">Фиксируем все детали в договоре. Предоплата 50%, остаток после монтажа.</p>
        </div>
        <div class="step-card card" style="padding: 2rem; border-radius: var(--radius-lg); background: var(--white); box-shadow: var(--shadow-sm); transition: transform 0.3s ease; text-align: center;">
          <div class="step-icon" style="width: 50px; height: 50px; background: var(--accent-terracotta); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--white); margin: 0 auto 1rem; font-weight: bold; font-size: 1.5rem;">4</div>
          <h3 style="margin-bottom: 1rem; color: var(--gray-800);">Доставка и монтаж</h3>
          <p style="color: var(--gray-700);">Привозим и собираем за 1–2 дня. Готово к использованию с гарантией!</p>
        </div>
      </div>
      <style>
        .step-card:hover {
          transform: translateY(-5px);
          box-shadow: var(--shadow-warm);
        }
      </style>
    </div>
  </section>

  <!-- JS: Без изменений (аккордеон и анимации работают) -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // FAQ Аккордеон с динамической высотой
      document.querySelectorAll('.faq-question').forEach(button => {
        button.addEventListener('click', function() {
          const answer = this.nextElementSibling;
          const isOpen = answer.classList.contains('active');
          const allAnswers = document.querySelectorAll('.faq-answer');
          const allButtons = document.querySelectorAll('.faq-question');
          const allToggles = document.querySelectorAll('.faq-toggle');

          // Закрыть все (сброс иконок и классов)
          allAnswers.forEach(ans => {
            ans.style.maxHeight = '0';
            ans.classList.remove('active');
          });
          allButtons.forEach(btn => btn.classList.remove('active'));
          allToggles.forEach(tog => tog.textContent = '+');

          if (!isOpen) {
            // Открыть текущий (динамическая высота)
            answer.classList.add('active');
            this.classList.add('active');
            const scrollHeight = answer.scrollHeight + 'px';
            answer.style.maxHeight = scrollHeight;
            this.querySelector('.faq-toggle').textContent = '−';
          }
        });
      });

      // Простая анимация появления (если нет AOS или подобного)
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
          }
        });
      }, observerOptions);

      document.querySelectorAll('[data-animate]').forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(el);
      });

      // Фильтрация и сортировка товаров
      const products = Array.from(document.querySelectorAll('.product-item'));
      const priceFilter = document.getElementById('priceFilter');
      const sortSelect = document.getElementById('sortProducts');
      const productsCount = document.getElementById('productsCount');
      
      function filterAndSort() {
        let visibleProducts = products.filter(product => {
          const priceText = product.querySelector('.product-price').textContent;
          const price = parseInt(priceText.replace(/[^\d]/g, ''));
          const priceValue = priceFilter.value;
          
          let matchesPrice = true;
          if (priceValue !== 'all') {
            if (priceValue === '200000-400000') matchesPrice = price >= 200000 && price < 400000;
            else if (priceValue === '400000-600000') matchesPrice = price >= 400000 && price < 600000;
            else if (priceValue === '600000+') matchesPrice = price >= 600000;
          }
          
          return matchesPrice;
        });
        
        const sortValue = sortSelect.value;
        if (sortValue === 'price-asc') {
          visibleProducts.sort((a, b) => {
            const priceA = parseInt(a.querySelector('.product-price').textContent.replace(/[^\d]/g, ''));
            const priceB = parseInt(b.querySelector('.product-price').textContent.replace(/[^\d]/g, ''));
            return priceA - priceB;
          });
        } else if (sortValue === 'price-desc') {
          visibleProducts.sort((a, b) => {
            const priceA = parseInt(a.querySelector('.product-price').textContent.replace(/[^\d]/g, ''));
            const priceB = parseInt(b.querySelector('.product-price').textContent.replace(/[^\d]/g, ''));
            return priceB - priceA;
          });
        } else if (sortValue === 'name-asc') {
          visibleProducts.sort((a, b) => {
            const nameA = a.querySelector('h3').textContent.toLowerCase();
            const nameB = b.querySelector('h3').textContent.toLowerCase();
            return nameA.localeCompare(nameB);
          });
        }
        
        products.forEach(p => p.style.display = 'none');
        
        const grid = document.querySelector('.products-grid');
        visibleProducts.forEach(product => {
          product.style.display = 'block';
          grid.appendChild(product);
        });
        
        productsCount.innerHTML = `Найдено товаров: <strong>${visibleProducts.length}</strong>`;
      }
      
      priceFilter.addEventListener('change', filterAndSort);
      sortSelect.addEventListener('change', filterAndSort);
    });
  </script>

  <style>
    @media (max-width: 768px) {
      .products-grid {
        grid-template-columns: 1fr !important;
        gap: 1.5rem !important;
      }

      .product-item {
        padding: 1.25rem !important;
      }

      .product-image {
        height: 200px !important;
      }

      .advantages-grid {
        grid-template-columns: 1fr !important;
        gap: 1.5rem !important;
      }

      .advantage-item {
        padding: 1.5rem !important;
      }

      .advantage-icon {
        width: 60px !important;
        height: 60px !important;
        font-size: 1.3rem !important;
      }

      .section-title {
        font-size: 1.75rem !important;
        margin-bottom: 2rem !important;
      }

      .hero-title {
        font-size: 1.75rem !important;
      }

      .hero-subtitle {
        font-size: 1rem !important;
      }

      .steps-grid {
        grid-template-columns: 1fr !important;
        gap: 1.5rem !important;
      }

      .step-card {
        padding: 1.5rem !important;
      }

      .faq-item {
        margin-bottom: 1rem !important;
      }

      .faq-question {
        padding: 1.25rem !important;
        font-size: 1rem !important;
      }

      .faq-answer-content {
        padding: 0 1.25rem 1.25rem !important;
      }

      .container {
        padding: 0 1rem !important;
      }

      .section {
        padding: 2.5rem 0 !important;
      }
    }

    @media (max-width: 480px) {
      .hero-title {
        font-size: 1.5rem !important;
      }

      .section-title {
        font-size: 1.5rem !important;
      }

      .product-price {
        font-size: 1.4rem !important;
      }

      .btn {
        padding: 0.875rem 1.25rem !important;
        font-size: 0.9rem !important;
      }
    }
  </style>

{% endblock %}
